{% extends "base.html" %}

{% block variables %}
<!-- this script needs to go here because this is a nice way to assess flask variables. -->
<script type="text/javascript">
    var blockRequest = {{ blockRequest }};
    if (blockRequest == 1) {
        $( ".requestBook").addClass( "disabled" );
    }
    var userRating = {{ userRating }};
    console.log(userRating);
    if (userRating != 0) {
        $( "#1").removeClass("grey-text lighten-1").addClass( "amber-text" );
        $(".star").unbind('mouseenter mouseleave');
        $('.star').each(function() { this.style.pointerEvents = 'none';})
    }
    if (userRating > 1) {
        $( "#2").removeClass("grey-text lighten-1").addClass( "amber-text" );
    }
    if (userRating > 2) {
        $( "#3").removeClass("grey-text lighten-1").addClass( "amber-text" );
    }
    if (userRating > 3) {
        $( "#4").removeClass("grey-text lighten-1").addClass( "amber-text" );
    }
    if (userRating == 5) {
        $( "#5").removeClass("grey-text lighten-1").addClass( "amber-text" );
    }

</script>
{% endblock %}

{% block content %}
<!-- add valign-wrapper to below row div? -->
    <div class="row"> 
        <div class="col s12 m6 l3 center-align">
            <img src= {{ thumbnail }} alt='coverThumbnail' onerror=imgError(this)>
            <br>
            <a class="btn requestBook">Request</a>
        </div>
        <div class="col l6 m6 s12 left-align">
            <h4>{{ title }}</h4>
            <h6>by {{ author }}</h6>
            <p>{{ short_description }}</p>
             <h6>Book Owner: @{{uploader}}<br>Current Location: {{location}} </h6>
        </div>
        <div class="col l3 left-align">
            <h4>Reviews</h4>
            <i class="material-icons small star grey-text lighten-1" id="1">star</i>
            <i class="material-icons small star grey-text lighten-1" id="2">star</i>
            <i class="material-icons small star grey-text lighten-1" id="3">star</i>
            <i class="material-icons small star grey-text lighten-1" id="4">star</i>
            <i class="material-icons small star grey-text lighten-1" id="5">star</i>
            <br>
            {% if average_rating != "na" %}
            <h6> Average Rating: {{average_rating}}</h6>
            {% endif %}
            {% if review != "" %}
            <p><i>"{{review}}" </i><br>- New York Times</p>
            {% endif %}
            <div class = "memberComments">    
                {% for comment in comments %}
                    <p><i>"{{comment[0]}}"</i><br>- {{comment[1]}}</p>
                {% endfor %}
            </div>
            <div class="input-field">
                <textarea id="comment" placeholder = "Share your thoughts!" class = "materialize-textarea " data-length="150"></textarea>
            </div>
            <button class="btn waves-effect waves-light addReview" type="submit">Add a review</button>
        </div>
    </div>
    
    <div class="row">
        <div class="col l12">
            {% if stops == 1 %}
            <h4> I'm still at home. </h4>
            {% else %}
            <h4> I've traveled to {{stops}} locations!</h4>
            {% endif %}
        </div>
    </div>

    <div class="row">
        <div class="col l4">
            <div id='map' style='width: 400px; height: 300px;'></div>
        </div>
        <div class="col l8"></div>
    </div>
{% endblock %}

{% block additionallibraries %}
<script type="text/javascript" src="{{ url_for('static', filename='js/bookpage.js') }}"></script>
{% endblock %}
